name: 'docker-metanorma-run'
description: 'Composite action which help to install custom/private flavors'
inputs:
  extra-flavors:
    description: 'Space separated list of extra flavor extensions'
    default: ''
  github-pakages-token:
    description: 'GitHub token to access '
    default: ''

runs:
  using: "composite"
  steps:
    - shell: bash
      run: apt-get update -y && apt-get install -y gcc g++ ruby-dev

    - shell: bash
      run: |
        if [ -f "~/.gemrc" ]; then
          echo "WARNING! Overwriting ~/.gemrc."
        fi
        cat << 'EOF' > ~/.gemrc
        ---
        :backtrace: false
        :bulk_threshold: 1000
        :sources:
        - https://x-access-token:${{ inputs.github-pakages-token }}@rubygems.pkg.github.com/metanorma/
        - https://rubygems.org/
        :update_sources: true
        :verbose: true
        EOF
        echo "~/.gemrc generated!"

    - shell: bash
      run: |
        for flavor in ${{ inputs.extra-flavors }}; then
          bundle add metanorma-${flavor}
        done
